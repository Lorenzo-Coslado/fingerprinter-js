<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test FingerprintJS Debug</title>
    <style>
      body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .result {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        font-family: monospace;
        word-break: break-all;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
      }
      button {
        background: #007acc;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #005999;
      }
      pre {
        background: #f8f8f8;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
      }
      .debug {
        background: #e7f3ff;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>üîç Test FingerprintJS Debug</h1>

    <p>Page de test avec debug pour le d√©veloppement local.</p>

    <div id="debug-info" class="debug">
      <strong>Debug Info:</strong><br />
      üîÑ Chargement en cours...
    </div>

    <button onclick="testFingerprint()">G√©n√©rer Empreinte</button>
    <button onclick="testComponents()">Voir Composants</button>
    <button onclick="runDebug()">Debug Complet</button>

    <div id="output"></div>

    <script src="dist/index.umd.js"></script>
    <script>
      function updateDebug(message, type = "info") {
        const debugDiv = document.getElementById("debug-info");
        const timestamp = new Date().toLocaleTimeString();
        debugDiv.innerHTML += `<br>[${timestamp}] ${type.toUpperCase()}: ${message}`;
      }

      function checkLibraryLoaded() {
        updateDebug("V√©rification du chargement de la biblioth√®que...");

        if (typeof FingerprintJS === "undefined") {
          updateDebug("‚ùå FingerprintJS n'est pas d√©fini", "error");
          return false;
        }

        updateDebug("‚úÖ FingerprintJS charg√©");
        updateDebug(`Type: ${typeof FingerprintJS}`);
        updateDebug(
          `Propri√©t√©s disponibles: ${Object.keys(FingerprintJS).join(", ")}`
        );

        if (FingerprintJS.default) {
          updateDebug("‚úÖ FingerprintJS.default disponible");
          if (typeof FingerprintJS.default.generate === "function") {
            updateDebug("‚úÖ M√©thode generate() disponible");
          }
        }

        if (FingerprintJS.Fingerprint) {
          updateDebug("‚úÖ Classe Fingerprint disponible");
        }

        return true;
      }

      async function testFingerprint() {
        try {
          updateDebug("D√©but de g√©n√©ration d'empreinte...");

          if (!checkLibraryLoaded()) {
            throw new Error("Biblioth√®que non charg√©e correctement");
          }

          const result = await FingerprintJS.default.generate();
          updateDebug("‚úÖ Empreinte g√©n√©r√©e avec succ√®s");

          document.getElementById("output").innerHTML = `
                    <div class="result success">
                        <h3>üéØ Empreinte g√©n√©r√©e</h3>
                        <p><strong>Hash:</strong> ${result.fingerprint}</p>
                        <p><strong>Confiance:</strong> ${result.confidence}%</p>
                        <p><strong>Nombre de composants:</strong> ${
                          Object.keys(result.components).length
                        }</p>
                        <details>
                            <summary>Voir les composants</summary>
                            <pre>${JSON.stringify(
                              result.components,
                              null,
                              2
                            )}</pre>
                        </details>
                    </div>
                `;

          console.log("Fingerprint result:", result);
          updateDebug(`Hash g√©n√©r√©: ${result.fingerprint.substring(0, 16)}...`);
        } catch (error) {
          updateDebug(`‚ùå Erreur: ${error.message}`, "error");
          console.error("Error:", error);
          document.getElementById("output").innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Erreur</h3>
                        <p><strong>Message:</strong> ${error.message}</p>
                        <p><strong>Stack:</strong></p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
        }
      }

      async function testComponents() {
        try {
          updateDebug("R√©cup√©ration des composants...");

          if (!checkLibraryLoaded()) {
            throw new Error("Biblioth√®que non charg√©e correctement");
          }

          const fp = new FingerprintJS.Fingerprint();
          const components = await fp.getComponents();
          updateDebug(
            `‚úÖ ${Object.keys(components).length} composants r√©cup√©r√©s`
          );

          document.getElementById("output").innerHTML = `
                    <div class="result success">
                        <h3>üìä Composants d√©taill√©s</h3>
                        <p><strong>Nombre de composants:</strong> ${
                          Object.keys(components).length
                        }</p>
                        <pre>${JSON.stringify(components, null, 2)}</pre>
                    </div>
                `;

          console.log("Components:", components);
        } catch (error) {
          updateDebug(`‚ùå Erreur: ${error.message}`, "error");
          console.error("Error:", error);
          document.getElementById("output").innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Erreur</h3>
                        <p><strong>Message:</strong> ${error.message}</p>
                        <p><strong>Stack:</strong></p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
        }
      }

      async function runDebug() {
        updateDebug("üîç D√©but du debug complet...");

        // Test de l'environnement
        updateDebug(`User Agent: ${navigator.userAgent.substring(0, 50)}...`);
        updateDebug(`Langue: ${navigator.language}`);
        updateDebug(`√âcran: ${screen.width}x${screen.height}`);
        updateDebug(
          `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}`
        );

        // Test Canvas
        try {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          updateDebug(
            ctx ? "‚úÖ Canvas 2D support√©" : "‚ùå Canvas 2D non support√©"
          );
        } catch (e) {
          updateDebug(`‚ùå Erreur Canvas: ${e.message}`, "error");
        }

        // Test WebGL
        try {
          const canvas = document.createElement("canvas");
          const gl = canvas.getContext("webgl");
          updateDebug(gl ? "‚úÖ WebGL support√©" : "‚ùå WebGL non support√©");
        } catch (e) {
          updateDebug(`‚ùå Erreur WebGL: ${e.message}`, "error");
        }

        // Test Audio
        try {
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          updateDebug(
            AudioContext
              ? "‚úÖ AudioContext support√©"
              : "‚ùå AudioContext non support√©"
          );
        } catch (e) {
          updateDebug(`‚ùå Erreur Audio: ${e.message}`, "error");
        }

        updateDebug("üîç Debug complet termin√©");
      }

      // Initialisation au chargement
      window.addEventListener("load", () => {
        updateDebug("Page charg√©e");
        checkLibraryLoaded();

        if (
          typeof FingerprintJS !== "undefined" &&
          FingerprintJS.default &&
          FingerprintJS.default.getAvailableCollectors
        ) {
          try {
            const collectors = FingerprintJS.default.getAvailableCollectors();
            updateDebug(`Collecteurs disponibles: ${collectors.join(", ")}`);
          } catch (e) {
            updateDebug(
              `Erreur lors de la r√©cup√©ration des collecteurs: ${e.message}`,
              "error"
            );
          }
        }
      });

      // Gestion des erreurs globales
      window.addEventListener("error", (e) => {
        updateDebug(`‚ùå Erreur globale: ${e.message}`, "error");
      });
    </script>
  </body>
</html>
